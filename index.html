<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Catálogo</title>
<style>
  body{font-family:Arial, sans-serif;background:#001540;padding:10px;color:#ffffff;}
  header{display:flex;align-items:center;margin-bottom:12px;}
  header img{height:80px;margin-right:12px;}
  h1{margin-bottom:12px;}
  form{background:#0e2434;padding:12px;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,0.1);}
  label{display:block;margin-top:6px;}
  input,select,textarea{width:100%;padding:6px;margin-top:4px;border-radius:6px;border:1px solid #000000;}
  button{margin-top:10px;padding:8px 12px;border:none;border-radius:6px;background:#06b6d4;color:#fffcfc;cursor:pointer;}
  .product-list{margin-top:20px;}
  .product-item{background:#000231;padding:8px;margin-bottom:6px;border-radius:6px;box-shadow:0 1px 4px rgba(0,0,0,0.1);display:flex;justify-content:space-between;align-items:center;}
  .product-item button{background:#8b0000;margin-left:6px;}
</style>
</head>
<body>

<header>

  <h1>Admin Catálogo</h1>
</header>

<form id="productForm">
  <label>Nombre</label><input type="text" id="name" required>
  <label>Descripción</label><textarea id="desc"></textarea>
  <label>Precio por fardo (Q)</label><input type="number" id="price" step="0.01" required>
  <label>Cantidad por fardo</label><input type="number" id="qtyPerFardo" step="1" required>
  <label>URL Imagen</label><input type="url" id="img" required>
  <label>Categoría</label><input type="text" id="category" placeholder="Ej: Coca Cola" required>
  <button type="submit">Añadir/Actualizar producto</button>
</form>

<div class="product-list" id="productList"></div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getDatabase, ref, set, push, onValue, remove, update } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCRzvwkeV8ceVnP5X2gA74a34iuClsc2qY",
  authDomain: "catalogo-f0b8e.firebaseapp.com",
  databaseURL: "https://catalogo-f0b8e-default-rtdb.firebaseio.com",
  projectId: "catalogo-f0b8e",
  storageBucket: "catalogo-f0b8e.firebasestorage.app",
  messagingSenderId: "100540032907",
  appId: "1:100540032907:web:a6acac793ff5c85884318e",
  measurementId: "G-PZK0757PMK"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const form=document.getElementById("productForm");
const productList=document.getElementById("productList");

let editingId=null;

// Añadir/Actualizar producto
form.onsubmit=async(e)=>{
  e.preventDefault();
  const data={
    name:document.getElementById("name").value,
    desc:document.getElementById("desc").value,
    price:parseFloat(document.getElementById("price").value),
    qtyPerFardo:parseInt(document.getElementById("qtyPerFardo").value),
    img:document.getElementById("img").value,
    category:document.getElementById("category").value
  };
  if(editingId){
    await update(ref(db,'products/'+editingId),data);
    editingId=null;
  }else{
    const newRef=push(ref(db,'products'));
    await set(newRef,data);
  }
  form.reset();
};

// Mostrar productos y botones eliminar/editar
onValue(ref(db,'products'),snapshot=>{
  productList.innerHTML="";
  snapshot.forEach(child=>{
    const p=child.val();
    const div=document.createElement("div");
    div.className="product-item";
    div.innerHTML=`<span>${p.name} (${p.category}) - Q${p.price}</span>
      <div>
        <button data-edit="${child.key}">Editar</button>
        <button data-del="${child.key}">Eliminar</button>
      </div>`;
    productList.appendChild(div);
  });

  document.querySelectorAll("button[data-del]").forEach(btn=>{
    btn.onclick=()=>remove(ref(db,'products/'+btn.dataset.del));
  });

  document.querySelectorAll("button[data-edit]").forEach(btn=>{
    btn.onclick=()=>{
      const key=btn.dataset.edit;
      onValue(ref(db,'products/'+key),(snap)=>{
        const d=snap.val();
        document.getElementById("name").value=d.name;
        document.getElementById("desc").value=d.desc;
        document.getElementById("price").value=d.price;
        document.getElementById("qtyPerFardo").value=d.qtyPerFardo;
        document.getElementById("img").value=d.img;
        document.getElementById("category").value=d.category;
        editingId=key;
      },{onlyOnce:true});
    }
  });
});
</script>
</body>
</html>
